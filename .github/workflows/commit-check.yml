name: "Commit Gatekeeper"

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-issue-number:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validate Latest Commit Message
        run: |
          # Get the latest commit message from the PR head
          COMMIT_MSG=$(git log -1 --pretty=%B)
          echo "Testing message: $COMMIT_MSG"

          # Regex looks for a '#' followed by digits (e.g., #123)
          if [[ ! $COMMIT_MSG =~ #[0-9]+ ]]; then
            echo "-------------------------------------------------------"
            echo "ERROR: Commit rejected!"
            echo "Your message must include a GitHub Issue number (e.g. #123)"
            echo "-------------------------------------------------------"
            exit 1
          else
            echo "Validation Successful: Issue number found."
          fi
